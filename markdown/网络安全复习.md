# 六种网络安全服务

1. 机密性
	阻止未经授权的用户非法获取保密信息：
    ① 存储的机密性：数据在系统中存储的过程中不被攻击者获得其内容；
    ② 传输的机密性：数据在网络中传输的过程中不被第三方获得其内容。 

	主要方法：物理保密、防窃听、防辐射、信息加密、通信业务填充机制等。 
2. 完整性
	在未经许可的情况下，保证数据不会被他人删除或修改（至少能发现被修改过）
	分为存储的完整性和传输的完整性：数据在存储和传输过程中不被偶然或故意地插入、删除、修改、伪造、乱序和重放。

	主要方法：数据校验和、数字指纹、消息校验码、防重放机制等。
3. 身份认证
	用户要向系统证明他就是他所声称的那个人，目的是为了防止非法用户访问系统和网络资源。
	它是确保合法用户使用系统的第一道关卡。
   
	主要方法：口令、数字证书、基于生物特征以及通过可信第三方进行认证等。
4. 访问控制
	限制主体对访问客体的访问权限，从而使计算机系统在合法范围内使用。
    建立在身份认证基础上，通过限制对关键资源的访问，防止非法用户的侵入或因为合法用户的不慎操作而造成的破坏。 

	主要方法：
    ① 宏观上：自主访问控制和强制访问控制等；
    ② 具体实现上：访问控制矩阵和访问控制表等。
5. 不可否认
	发送方/接收方不能否认它曾经在某时发送/接收过的数据。即通信方必须对自己行为负责，而不能也无法事后否认，其他人也无法假冒通信方成功。
    ① 发送方的不可否认
    ② 接收方的不可否认
    ③ 时间上不可否认 
   
	主要方法：数字签名、数字签名收条和时间戳等。
6. 可用性
	我们要求计算机或网络能够在我们期望它以我们所期望的方式运行的时候运行。
    ① 物理上的可用性
    ② 防止拒绝服务来实现可用性。 

	主要方法：
    ① 保证设备的正常使用不受断电、地震、火灾、水灾等影响；
    ② 对网络阻塞、网络蠕虫、黑客攻击等导致系统崩溃或带宽过度损耗的情况采取措施。

# 哪种攻击方式攻击哪种安全服务
| 攻击方式   | 安全服务 |
| ---------- | -------- |
| 中间人攻击 | 完整性   |
| 拒绝服务攻击 | 可用性   |
| 会话注射攻击 | 身份认证 |
|缓冲区溢出攻击|访问控制|

缓冲区溢出（Buffer Overflow）攻击：
攻击者利用计算机指令系统弱点，分析有缺陷程序代码，向程序提交恶意超长的输入数据，破坏或改写内存中控制流程的关键信息，获得进程的控制权。
根本原因：C/C++没有对数组引用进行边界检查：
①如果读取数组以外内容，会使程序得出错误结果
② 如果是写入，可能破坏该进程内存的其它内容 

中间人（Man In The Middle，MITM）攻击：
基于ARP/DNS欺骗，后者可在广域网内进行
还能利用配置不当的加密协议，如SSH1/SSL协议

会话注射（Session Injection）：
是会话劫持不同于（强于）其他攻击的特点所在：
① 合法用户先完成身份认证；
② 劫持者再冒充合法用户，以正确的ISN向服务器发送数据（cat/etc/password）：
   Ⅰ向合法用户发RST包使其下线；
   Ⅱ注射完数据后，再把连接交还合法用户。
在一定意义上实现IP欺骗攻击：不用猜服务器的ISN，可直接得到，因已被劫持。

拒绝服务（Denial of Service）：
使服务器不能正常地对外界提供服务

# 协议的安全隐患

1. 链路层

   1. ARP协议的安全隐患
      ARP缓存可能被毒害——ARP欺骗

   2. 以太网协议CSMA/CD的安全隐患
      共享方式传送数据——网卡混杂模式嗅探

2. 网络层

   1. IP协议的安全隐患
      ① 不能为数据提供完整性、机密性
      ② 路由和分片机制——数据包内容易被篡改
      ③ 对源IP地址不进行认证——IP欺骗攻击
      ④ 可以设置“源路由”选项——源路由欺骗攻击
      ⑤ “IP分片包”的威胁——分片扫描和拒绝服务攻击

   2. ICMP协议的安全隐患
      ICMP echo广播响应包——拒绝服务攻击
      利用隧道技术封装成ICMP包来建立隐藏通道/穿越防火墙

3. 传输层

   1. TCP协议的安全隐患
      ① 三次握手中源IP地址可以虚假——拒绝服务攻击
      ② TCP中的序列号并不真正随机——IP欺骗攻击
      ③ 可以定制所发送TCP包的标志位——隐蔽扫描

   2. UDP协议的安全隐患
      无连接、不可靠的协议——拒绝服务攻击

4. 应用层

   1. DNS协议的安全隐患
      DNS缓存可能被毒害——DNS欺骗、区域传输

   2. 路由协议的安全隐患
      路由信息可以被篡改——修改网络数据传输路径 

   3. Web协议的安全隐患

   4. 其他协议的安全隐患

# 操作系统的安全级别

![1561514626368](C:\Users\xiaoxx\AppData\Roaming\Typora\typora-user-images\1561514626368.png)

根据安全性相近原则，安全级别分为如下四类：

1. D级，什么保护要求都没有；
2. C1、C2、B1级，目前流行的商用操作系统；
3. B2级，要求对基础模型的安全性给出精确证明，TCB有清楚的技术规范说明；
4. B3和A1级，要求更精确证明TCB和形式化设计。

> 其中B1和B2的安全强度有明显区别，B2和B3之间也有显著差别。

- D级——最低保护

  指未加任何实际安全措施，整个系统都不可信任。

  ① D系统只为文件和用户提供安全保护，操作系统很容易受到损害。
  ② 任何人不需要任何账户就可进入系统，不受任何限制就可访问他人文件。
  ③ D系统最普遍形式是本地操作系统，或一个完全没有保护的网络。 

- C级——被动的自主访问策略

  - C1级：具有一定自主访问控制（DAC）机制，通过将用户和数据分开达到安全目的。
  ① 它要求系统硬件有一定的安全保护。
  ② 用户使用前必须登录系统，允许管理员为一些程序和数据设定访问权限。
  ③ C1系统不能控制进入系统的用户访问级别，而且所有文档具有相同的机密性。

  - C2级：又称为访问控制保护，具有更细分每个用户的DAC机制。
    ① 引入审计机制，并对审计使用身份认证。
    ② 连接到网络上时，C2系统的用户对各自行为负责。
    ③ C2系统进一步限制用户执行某些命令或访问某些文件的权限，而且还对用户分组进行身份认证。 

- B级——被动的强制访问策略

  - B1级：满足C2级的所有要求，对象还必须在强制访问控制之下，不允许拥有者更改它们的权限。

  - B2级：TCB基于明确定义的形式化模型，系统中所有主体和客体实施MAC。要求系统中的所有对象加标签，具有可信通路机制、系统结构化设计、最小特权管理及对隐藏通道的分析处理。

  - B3级：TCB要能对系统中所有主体和客体的访问进行控制，不会被非法篡改。

- A级——形式化证明的安全

  类似于B3级，包括一个严格的设计、控制和验证过程。

  ① 设计必须是从数学角度经过验证的。
  ② 特色在于形式化的顶层设计规格FTDS、形式化验证FTDS与形式化模型的一致性和由此带来的更高的可信度。 

# 主动攻击、被动攻击

主动攻击：伪装成其他用户、篡改C/S之间信息或篡改Web站点信息（难预防但易检测）
被动攻击：监听数据流获取信息或进行信息量分析（难检测但易预防） 

被动攻击技术：嗅探技术



# 数字签名 数字证书 数字指纹 数字信封

数字签名：发送方用自己私钥对消息（或消息散列值）加密就是该用户对该消息的数字签名，可以保证发送方不可否认。

数字证书：数字证书是一个经认证中心CA数字签名的包含公钥拥有者信息及其公钥的文件。

数字信封：在实际应用中，并不直接使用公开加密算法加密明文，而仅用它保护实际用于加密明文的对称密钥。

数字指纹：消息的散列值（或MAC值），即消息摘要。

数字身份证：用户的私钥。

# ppdr模型

![批注 2019-06-26 112725](C:\Users\xiaoxx\OneDrive\图片\批注 2019-06-26 112725.jpg)

## PPDR模型的四个环节

（1）Policy（安全策略）
    PPDR安全模型的核心，描述系统哪些资源需要保护，如何实现保护。
（2）Protection（防护）
    加密机制、数字签名机制、访问控制机制、认证机制、信息隐藏、防火墙技术等。 
（3）Detection（检测）
    入侵检测、系统脆弱性机制、数据完整性机制、攻击性检测等。 
（4）Response（响应）
    应急策略、应急机制、应急手段、入侵过程分析、安全状态评估等。 

① 没有一项防护技术完美，检测和响应是最基本的，因此防护不是必须的，检测和响应是必须的。
② 防护、检测和响应组成了一个完整的、动态的安全循环，在安全策略指导下保证信息系统的安全。

## PPDR模型的时间特性

（1）攻击时间Pt
    黑客从开始入侵到侵入系统的时间（对系统是保护时间）。高水平入侵和安全薄弱系统使Pt缩短。
（2）检测时间Dt
    黑客发动入侵到系统能够检测到入侵行为所花费的时间。适当的防护措施可以缩短Dt。
（3）响应时间Rt
    从检测到系统漏洞或监控到非法攻击到系统做出响应（如切换、报警、跟踪、反击等）的时间。
（4）系统暴露时间Et=Dt+Rt-Pt
    系统处于不安全状态的时间。
    系统的检测时间和响应时间越长，或系统的保护时间越短，则系统暴露时间越长，就越不安全。

> 如果Et小于等于0，那么基于PPDR模型，认为系统安全。要达到安全的目标需要尽可能增大保护时间，尽量减少检测时间和响应时间。

# 传统密码学内容

算法和密钥都必须保密，如模3的恺撒加密算法。但若N个人两两相互通信则需要互不相同的算法太多。

三个阶段；四个空间；量子信道和量子密码学

信使；印地安人语言；语言学规律、统计学

替换、换位；混淆、散布；难解性
传统密码学、对称密码学、公开密码学的算法数/密钥数的比较

口令的位数（8位）和每一位的取值范围（熵的变化）

> ## Page 48

# 常见对称加密算法的分类和特点

对称密码技术也叫做单钥或常规密码技术，包括分组密码技术和流密码技术这两个重要的分支。

常见的对称加密算法：DES   3DES   IDEA   AES等

1. 数据加密标准DES
    1）DES是一种对二元数据进行加密的算法，将明文消息分成64bit一组进行加密。密文分组的长度也是64bit，没有数据扩展。
    2）DES使用“密钥”进行加密，从符号的角度看，“密钥”的长度是64bit。
    3）但是由于某些原因，DES算法中每逢第8bit就被忽略，这造成密钥的实际大小为56bit。
    DES特点：DES的整个体制是公开的，系统的安全性完全依赖密钥的保密。

**DES特点**：具有雪崩效应：明文或密钥1bit改变引起密文许多bit改变。如果密文的变化太小，就可能找到一种方法减小要搜索的明文和密钥空间。

  ​	1）当密钥不变，明文产生1bit变化，在3次循环后，两个分组有21bit不同，而整个加密过程结束后，两个密文有34个位置不同。
  ​	2）作为对比，明文不变，密钥发生1bit变化时，密文中有大约一半的bit不同。

2. 三重DES
     三重DES是人们在发现DES密钥过短，易于受到蛮力攻击而提出的一种替代加密算法。
     三重DES使用3个密钥，执行3次DES算法。加密过程为加密-解密-加密（EDE），可表示为如下的公式：
		`C=EK3(DK2(EK1(M)))`
     
     为了避免三重DES使用3个密钥进行三阶段加密带来的密钥过长的缺点（168bit）,Tuchman提出使用两个密钥的三重加密方法，这个方法只要求112bit密钥，即令其K1=K3：
		`C=EK1(DK2(EK1(M)))`
     
     三重DES的第二阶段的解密并没有密码编码学上的意义。它的唯一**优点**是可以使用三重DES解
     密原来的单次DES加密的数据，即K1=K2=K3。
         `C=EK1(DK1(EK1(M)))=EK1(M)`
     
3. IDEA

     国际数据加密算法IDEA
         IDEA使用的是128bit密钥。IDEA与DES的明显区别在于循环函数和子密钥生成函数的不同。

     1）对循环函数来说，IDEA不使用S盒子，而且IDEA依赖于3种不同的数学运算：
             XOR、
             16位整数的二进制加法、 
             16位整数的二进制乘法。
           这些函数结合起来可以产生复杂的转换，这些转换很难分析，也很难进行密码分析。

     2）子密钥生成算法完全依赖于循环移位的使用，但使用方式复杂，对IDEA的8个循环中的每一个都会生成6个子密钥。

       IDEA算法有如下**优点**：
        - 加密速度快
        - 密钥产生简单
        - 用软硬件都能实现

4. 高级加密标准AES
    1）AES的基本要求是，比三重DES快而且至少和三重DES一样安全。
    2）AES分组长度为128bit，密钥长度为128/192/ 256bit。
   **特点**：
     1）安全性： Rijndael算法抗线性攻击和抗差分攻击的能力大大增强。
     2）算法的速度：RC6需要用到乘法运算，并且需要大量内存；Twofish不便于在硬件中实现；Mars和Serpent的速度都不如Rijndael。
     3）灵活性： Rijndael的密钥长度可根据不同的加密级别进行选择。 Rijndael的分组长度也是可变的，弥补了DES的弊端。 Rijndael的循环次数允许在一定范围内根据安全要求进行修正。

| 算法    | 密钥长度    | 分组长度    | 循环次数 |
| ------- | ----------- | ----------- | -------- |
| DES     | 56          | 64          | 16       |
| 三重DES | 112/68      | 64          | 48       |
| IDEA    | 128         | 64          | 8        |
| AES     | 128/192/256 | 128/192/256 | 10/12/14 |

# 公开加密算法所基于的不同的难解性问题

1. RSA：大合数分解成大质数的困难（可用于加密和数字签名）

   1）一个函数生成两个密钥
   2）不能由其中一个推导到另外一个
   3）一个密钥用于加密，另一个用于解密
   4）哪一个用于加密，哪一个用于解密无所谓
   5）但用一个加密的密文，肯定能用另一个解密

2. D-H：离散对数（只用于密钥交换）

3. 椭圆曲线：公开加密算法的发展方向

4. 数字签名标准：DSS

# 对称加密和公开加密的区别

1. 对称加密需要1个密钥，公开加密需要2个密钥

2. 对称加密对密钥保密，对称加密将自己的一部分密钥公开

3. 对称加密比公开加密的速度快但是安全性没有对称加密的程度高。

# 常见的现代密码学加密算法

对称加密：DES   3DES   IDEA   AES   RC4等

公开加密：RSA

# 散列函数  散列值 散列值与mac值的区别 散列和签名的不同

散列函数：一个将任意长度的消息映射为定长的散列值的公开函数，以散列值作为验证码。

消息验证码(MAC)：以一个公开函数和一个密钥作用于消息，产生一个定长数据分组，即消息验证码，并将其附加在报文中。

数字签名：发送方用自己私钥对消息（或消息散列值）加密就是该用户对该消息的数字签名，可以保证发送方不可否认。

# 现代密码学不同算法的使用

在实际应用中，并不直接使用公开加密算法加密明文，而仅用它保护实际用于加密明文的对称密钥，即所谓的数字信封技术。

使用这种方式，用户可以在每次发送保密信息时都使用不同的对称密钥，从而增加密码破译的难度。一次密码的破译不影响其他传递。

## 结合使用

> 见PGP

# DH算法 

Diffie-Hellman密钥交换算法 

公开加密算法原理
• Whitfield Diffie和Martin Hellman提出D-H密钥交换算法——公钥密码体制出现

• D-H算法的重大意义——第一次提出不需要保密信道来安全分发对称密钥

• 公钥加密是重大创新（每人一对密钥）——根本上改变加/解密过程 

- 公开加密系统的密钥对

  每个用户两个密钥：
  • 一个密钥（“私钥”）保密，只能在一方保存。
  • 另一个密钥（“公钥”）不保密，可广泛共享。

  • “密钥对”具有数学上特殊的互补关系，每个密钥只能与密钥对中的另一个密钥配合进行加/解密。

- 公开加密算法的设计考虑 

  • 特意设计成两个密钥之间无法简单推导。

    因此不能根据公钥得到私钥，且从公钥和密文得到明文或私钥计算上不可行。

  • 但是要求公钥算法必须足够强大，密钥对必须足够长（因此造成加/解密速度慢），才能使人们无法使用穷举攻击来破解密文。

- 公开加密算法的用途 

  • A和B都有密钥对，并已分别获得对方真正的公钥。
  • A要发送消息给B，使用公开加密算法的两种用法：

  1）A用B的公钥加密          B用自己私钥解密
      非B不能得到A发送的消息（保证机密性）

  2）A用自己私钥加密         B用A的公钥解密
      别人不能假冒A发送消息
      A也不能否认发送过该消息（数字签名不可否认）

  ## D-H算法的用途和特点

  算法本身局限于密钥交换用途，而不能实现加密和数字签名。安全性依赖于计算离散对数的困难性。

  特点
  1）只在需要时才计算出对称密钥，对称密钥不需保存，也不会泄密。
  2）密钥交换只需要约定全局参数。
  3）不需要PKI的支持，目前SSL、IPSec等都使用D-H密钥交换算法。 

  ## D-H密钥交换算法的原理

  ![1561534392785](C:\Users\xiaoxx\AppData\Roaming\Typora\typora-user-images\1561534392785.png)

  ## D-H算法的功能和证明

  D-H算法的功能：
      A想要与B建立连接，并安全地在双方之间生成一个共享的对称密钥，用来加密要传递的消息本身。

  ![1561534440763](C:\Users\xiaoxx\AppData\Roaming\Typora\typora-user-images\1561534440763.png)

  ## D-H算法举例

  素数q=97，原根a=5，私钥XA=36，私钥XB=58

  ![1561534469892](C:\Users\xiaoxx\AppData\Roaming\Typora\typora-user-images\1561534469892.png)

  ## D-H算法的安全性

  • D-H算法中的计算公式都是单向函数，其逆运算就是求解离散对数问题，所以具有难解性。

	当q、a、YA、YB和K都足够大时：
• 黑客由q、a和截获的公钥YA/YB并不能得到A/B的私钥XA/XB。
• 即使截获大量密文破解了本次K，由K、q和截获的公钥YA/YB ，也不能得到A/B的私钥XA/XB。

  ## D-H算法的不足
  
  1）没有提供通信双方的身份信息，所以不能鉴别双方身份，容易遭受中间人攻击。 
  
  2）是密集型计算，容易遭受拒绝服务攻击，即攻击者请求大量密钥，被攻击者花费大量计算资源求解无用的幂系数。
  
  3）无法防止重放攻击。
  
  ## D-H算法中间人攻击示意图 
  
  ![1561534589307](C:\Users\xiaoxx\AppData\Roaming\Typora\typora-user-images\1561534589307.png)
  
  ## D-H算法的改进
  
  OAKLEY算法改进了D-H算法，具有五个重要特征：
  
  1）采用64位随机cookie对抗拒绝服务攻击。cookie为双方提供一种较弱的源地址认证，如果伪造了源地址，则攻击者不能得到该cookie并攻击成功。
  
  2）使得双方能够协商全局参数。
  3）增加了“现时”机制来抗重放攻击。
  4）能够交换D-H的公开密钥。
  5）对D-H中公钥值的交换进行身份鉴别。
  
  ## 好的加密算法的特点 
  
  1）算法要足够强大：从截获的密文或某些已知明文密文对，计算出密钥或明文是不可行的。
  2）加密系统的安全不依赖于算法的保密，而依赖于密钥——Kerckhoff原则。
  
  3）正常加密和解密要快，破译越慢越好。
  4）密文相对明文最好无数据位扩展。
  5）好的加密算法要具有雪崩效应。
  6）好的加密算法的密文很难被压缩。

# CA算法签发证书 

数字证书的创建和使用：
① 要发布自己公钥的用户A申请证书，CA核实身份后颁发证书（CA的主要职责）：
        CA=E(PRCA, [Time1||IDA||PUA])
② 其他用户B得到CA，并用已得到的CA的真实公钥PUCA验证该证书是真实的：
        D(PUCA, E(PRCA, [Time1||IDA||PUA]))
    就可以得到A的真实公钥PUA。

证书要放在证书库中

证书怎么生成的

拿到别人的证书如何得到公钥

# 口令破解

① 手工尝试（猜测）
② 对口令文件使用破解工具（字典/暴力/组合攻击）
③ 使用嗅探技术获得口令
④ 使用社会工程方法获得口令
⑤ 恶意网页和恶意电子邮件
⑥ 通过键盘记录器获得口令
⑦ 账号口令锁定机制→拒绝服务攻击

什么样的（口令）安全，什么样的不安全

# 密钥管理和分配问题

1. 初始化阶段
   1. 终端实体注册
      • 是单个用户或进程的身份被建立和验证的过程。
      • 是在线执行的，用注册表格的交换来实现。
   
   • 注册中心RA是证书注册审批机构，与CA逻辑上是一个整体，可单独也可合并在CA中实现。
   • 只有CA而非RA有权颁发证书和撤消证书。 
   
   2. 密钥对产生
   
      终端实体（用户）的密钥对有两种产生方式：
   
      | 产生方法        | 分发方法                         | 优点                   | 缺点                             | 对应证书类型                     | 适用场合          |
      | ------------------- | ------------------------------------ | -------------------------- | ------------------------------------ | ------------------------------------ | ---------------------------- |
      | 用户自己生成    | 将自己公钥以安全方式传送给CA | CA也不知道用户私钥 | 密钥对安全强度可能不高           | 由浏览器产生的普通证书和测试证书 | 不适合比较重要的网络交易 |
      | CA替用户生成 | 将用户私钥以安全方式传送给用户   | 密钥对安全强度比较高   | CA必须销毁自己保存的用户私钥 | 商家证书和服务器证书             | 重要的应用场合           |
      
      双密钥对模型中密钥管理的区别：
      
      |                         | 支持服务                                      | 两个密钥对                             | 本人用的私钥的管理     | 他人用的公钥的管理                  |
      | ----------------------- | --------------------------------------------- | ------------------------------------------ | ----------------------------- | ------------------------------------------ |
      | 一个 | 不可否认                               | 签名私钥/验证公钥对（生存期长） | 签名私钥不能备份和存档 | 验证公钥需备份和存档   (即密钥档案) |
      | 用户 | 机密   性 | 加密公钥/解密私钥对（生存期短） | 解密私钥需备份和存档   (即密钥历史) | 加密公钥不需备份和存档 |
      
   3. 证书创建
   
      只能由CA创建，所有要与该用户进行安全通信的其他用户都会向CA请求该用户的证书。
   
   4. 证书分发
   
      最成熟的证书分发——证书使用者查询网上的证书库，以得到其他用户的证书。
   
      • 与该用户通信的对方必须容易获得该用户的：
         1）用于机密性的证书
         2）用于数字签名的证书。 
   
   5. 密钥备份和托管、存储
   
     - 忘记保护解密私钥的口令、磁盘被破坏或雇员被解雇等造成无法访问解密私钥——密钥备份。
     - 若注册时声明密钥对用于加/解密，那么CA可对该用户的解密私钥进行备份。
   
     - 密钥托管——用户把自己的解密私钥交由第三方保管，允许他解密有关密文。
     - 由政府担任可信第三方的被托管密钥是GAK（政府访问密钥）。 
     - 使用PKCS#12作为用户私钥和证书的封装形式。
   
2. 颁布阶段

   1. 证书检索

      有两种不同的情况需要检索一个终端实体证书：

      ① 数据加密发给其他实体的需求（保证机密性）；
      ② 验证从另一个实体收到的数字签名的需求（实现对数字签名的验证）。 

   2. 证书验证
   
   3. 密钥恢复
   
      - 密钥恢复——解密私钥已被破坏但没被泄露时， 从备份（用户的密钥历史）中重新得到该密钥。
   
      - 密钥管理生命周期包括从远程备份设施（如密钥恢复中心或CA）自动化地恢复解密私钥的能力。
   
   4. 密钥更新
   
      密钥更新——证书“接近”过期或私钥泄露时，必须自动化地颁发一个新的公/私钥对和相关证书。
   
3. 取消阶段

   1. 证书过期

      证书的有效期结束后将会过期，该终端实体可能做如下三件事之一：

      - 证书恢复：相同的公钥被加入具有新有效期的新证书（密钥对和证书仍然可靠）；
      - 证书更新：产生新的公/私钥对并颁发新的证书；
      - 没有活动：不再参加PKI。

   2. 证书撤销

      证书自然过期之前对证书的即时取消，警告其他用户不要再使用这个公钥。

        撤销原因：
      - 雇佣终止
   
      - CA签名私钥的泄露
   
      - 用户的身份改变

      - 遗失保护签名私钥的口令
   
      - 用户私钥被盗
   
        ![批注 2019-06-26 121208](C:\Users\xiaoxx\OneDrive\图片\批注 2019-06-26 121208.jpg)
   
     证书撤消实例方案 ：
   
   ![1561522381255](C:\Users\xiaoxx\AppData\Roaming\Typora\typora-user-images\1561522381255.png)
   
   3. 密钥销毁
   
      销毁密钥的原因：
   
      ① 密钥使用时间越长泄露机会越大；
      ② 如果密钥已泄露，那么密钥使用越久损失越大；
      ③ 破译者愿意花费更多精力破译使用久的密钥。
   
      密钥的所有拷贝都被销毁，重新生成该密钥的全部信息也被删除时，该密钥的生命周期才终止。 
   
   4. 密钥历史
   
      保证机密性的加密公钥总要过期，因此用户必须安全可靠地存储相应的解密私钥。
   
   5. 密钥档案
   
      用户应该可靠地保存已经过期的用于验证他人数字签名的该用户公钥，以便再次对他人的数字签名进行验证，主要用于审计和出现交易争端时。

# 安全协议

## 信任关系和信任模型

用户必须完全相信CA是公正和正确的；
• 一个被用户信任的实体可向用户推荐他所信任实体，而这个实体又可推荐其他实体          信任路径

X.509中的“信任”：当实体A假定实体B严格地按A所期望的那样行动，则A信任B。
PKI中的“信任”：如果用户假定CA可以将任一公钥准确绑定到某个实体上，则他信任该CA。 

建立信任模型的目的：确保一个CA签发的证书能够被另一个CA的用户所信任。 

严格层次结构模型是一棵倒置的树：
    “树根”代表对所有实体有特别意义的CA——根CA，是信任的根或“信任锚”——认证起点/终点。 

## 访问控制技术

访问控制技术，指防止对任何资源进行未授权的访问，从而使计算机系统在合法的范围内使用。意指用户身份及其所归属的某项定义组来限制用户对某些信息项的访问，或限制对某些控制功能的使用的一种技术，如UniNAC网络准入控制系统的原理就是基于此技术之上。

访问控制通常用于系统管理员控制用户对服务器、目录、文件等网络资源的访问。

## 电子邮件的安全性以及几个主要的安全协议模型

1）电子邮件的内容是公开的和可获取的。
2）邮件在网络上反复复制，传输路径不确定，易遭到窃取、篡改、假冒甚至破坏。

电子邮件的安全需求：
1）机密性——只有真正的接收方才能阅读邮件
2）完整性——电子邮件在传输过程中不被修改
3）认证性——信息的发送者不被假冒
4）不可否认性——发信人无法否认发过电子邮件 

电子邮件的安全问题：
1）垃圾邮件——增加网络负荷，占用服务器空间
2）诈骗邮件——能迅速让大量受害者上当
3）邮件炸弹——短时间内向同一邮箱发送大量电子邮件
4）通过电子邮件/附件传播网络蠕虫/病毒
5）电子邮件欺骗、钓鱼式攻击

邮件具有单向性和非实时性——不能通过建立隧道来保证安全，只能对邮件本身加密 

### 安全电子邮件标准

1. PEM（privacy enhanced mail，增强型邮件保密）标准

   • 在邮件标准格式上增加加密、认证和密钥管理
   • 在MIME之前出现，所以不支持MIME

   • 依赖一个既存的、完全可操作的PKI，发展被限制
   • PEM像一个OSI标准，PGP像一个Internet软件包 

2. PGP（pretty good privacy，高质量保密）标准 

   • 符合PEM的绝大多数规范，但不要求存在PKI

   • 创造性结合公钥加密的方便和对称加密的高速度

   • 数字签名和密钥管理机制设计巧妙

   • 不仅功能强大，速度快，而且源代码公开

3. S/MIME（secure/multipurpose Internet mail extensions，安全/多用途因特网邮件扩展）标准 

   • 并非只能用于邮件传输，任何支持MIME的传输机制都可使用，如HTTP

   • 对电子邮件最有效，因为必须保证邮件本身安全

   • 认证机制依赖于层次结构的CA（Tree of Trust）

   • 证书格式采用X.509规范，但支持的厂商比较少 

#### 4. PGP标准

• Philip Zimmermann于1991年发布PGP 1.0
• 可在各种平台（Windows、UNIX等）免费运行
• 还可用于普通文件加密及军事目的

• 所用算法被证实为非常安全：
  1）公钥加密算法RSA、DSS和Diffie-Hellman
  2）对称加密算法IDEA、3DES和CAST-128
  3）散列算法SHA-1

特点：
1）使用散列函数对邮件内容签名，保证信件内容不被篡改；
2）使用公钥和对称加密保证邮件内容机密且不可否认；
3）公钥的权威性由收发双方所信任的第三方签名认证；
4）事先不需要任何保密信道来传递对称的会话密钥

- PGP的Web of Trust 

  • “信任”或是双方的直接关系，或是通过第三者、第四者的间接关系。

  • 任意两方对等，整个信任关系构成网状结构。

  • PGP没有严格CA的约束，用户自行决定信任谁。

  • 若把使用PGP的用户限制在一定范围，则PGP比PEM更安全，因为信任链由用户自己维护

- PGP的功能 

  ![1561533509943](C:\Users\xiaoxx\AppData\Roaming\Typora\typora-user-images\1561533509943.png)

  > PGP加密系统的安全性主要取决于RSA和IDEA的破解难度

  1. 完整性鉴别

     • MD5散列任意长度的报文，产生128位的报文摘要。

     • 报文摘要唯一对应原始报文，如果原始报文改变并再次散列，生成的报文摘要不同。

     • 接收者收到的报文摘要应与对收到的邮件明文进行散列得到的散列值匹配，否则报文不完整。

  2. 数字签名

     用发送方A的RSA私钥PRA对明文的散列加密，即实现数字签名：

     1）只有用发送方公钥才能解开，实现了发送方对所发送报文的不可否认性；
     2）还保证了数据的完整性；
     3）同时签名速度比较快。
     4）利用数字签名一定程度上认证了发送方的身份。 

  3. 压缩

     1）先签名，后压缩
         若对压缩的消息签名，对验证签名的结果进行动态解压缩的算法则很不稳定。

     2）先压缩，后加密
       • 减少了网络传输时间和磁盘空间 
       • 压缩实际上也是一种“混淆”
       • 先加密后压缩，压缩效果较差 

  4. 机密性

     链式加密（数字信封）：
     1）用接收方B的公钥PUB加密对称的会话密钥KS
     2）以KS为IDEA密钥对压缩的明文加密
        既有RSA加密的保密——安全传递IDEA密钥
        又有IDEA算法的快捷——保证消息自身的安全

     优点：
     1）发送方随机产生KS，不需和接收方协商
     2）一次KS的泄漏不影响其他次密文传递的安全
     3）用RSA公钥PUB对KS加密保证加密的速度

  5. 电子邮件的兼容性

     | 密文由任意8bit字节流组成 | base64转换算法 | 其他的文件系统只允许使用ASCII字符组成的报文 |
     | ------------------------ | -------------- | ------------------------------------------- |
     |                          | →              |                                             |

      • base64转换导致消息大小增加33%

      • 压缩的效果不仅可补偿base64转换导致的膨胀，还可大大减少占用空间

  6. 分段和重装
  
     PGP报文大小受限于最大报文长度（50000个字节）的限制：
  
     • 分段在所有其他处理（含base64转换）之后才进行
  
     • 会话密钥和签名部分只出现在第一个报文段开始
  
     • 接收端剥掉所有的电子邮件首部，才能重新装配成原来的完整分组 

## SSL协议有哪些作用

• Secure Socket Layer，安全套接层协议，会话层，由Netscape推出。

• 主要实现Web服务器和浏览器之间的安全通信。 

• 在应用层协议和TCP/IP 协议之间提供机密性、完整性、服务器认证及可选的客户机认证的机制。

### 子协议

第一层：

- SSL握手协议：用公开加密算法验证服务器身份，并传递客户端产生的对称的会话密钥（先）

  Handshake Protocol的协商结果是SSL记录协议处理的基础，ContentType为22。协议头有三个部分：
  ① 消息类型（1B）
  ② 消息长度（3B）
  ③ 内容（1B）：与该消息有关的参数

  SSL v3.0的握手过程用到三种协议：握手协议、更改密码规格协议和警告协议。 

  - 握手消息及参数：

  | **消息类型**            | **参数**                                            |
  | ----------------------- | --------------------------------------------------- |
  | **hello_request**       | **Null**                                            |
  | **client_hello**        | **版本，随机数，会话**ID，   **密码参数，压缩方法** |
  | **server_hello**        | **版本，随机数，会话**ID，   **密码参数，压缩方法** |
  | **certificate**         | **X.509v3**证书链                                   |
  | **server_key_exchange** | **参数，签名**                                      |
  | **certificate_request** | **类型，**CA                                        |
  | **server_done**         | **Null**                                            |
  | **certificate_verify**  | **签名**                                            |
  | **client_key_exchange** | **参数，签名**                                      |
  | **Finished**            | **Hash**值                                          |

  - SSL握手过程：

  ![1561535413264](C:\Users\xiaoxx\AppData\Roaming\Typora\typora-user-images\1561535413264.png)

  - 握手协议的Hello阶段：
  ——协商协议版本、会话ID、密码组、压缩算法、交换随机数等。 

  	（1）Client Hello消息
      	客户端将版本号、随机数、会话ID、支持的密码算法组合和压缩算法发给服务器供其选择。

  	（2）Server Hello消息
      该消息做出决定并将决定传回客户端：版本号、会话ID、服务器随机数、选择的密码算法组合和压缩算法。

  - 握手协议的Key Agreement阶段

    ——发送服务器证书，并请求客户端证书（可选）。

    （3）Certificate消息
        服务器发送自己证书给客户端以证明自己身份。

    （4）Server Hello Done消息
        服务器向客户端表明Server Hello结束。

    （5）Client Key Exchange消息
        客户端用服务器的公钥加密预主密钥发送给服务器，以便双方协商会话密钥。

  - 握手协议的Finished阶段：

    ——改变密码组，完成握手。

    （6）Change Cipher Spec消息
        表示记录加密及认证的改变，指示将启用新密钥。

    （7）Finished消息
        客户端收到Finished消息表明服务器已用私钥解开预主密钥，并最终生成了正确的会话密钥。

    特殊消息ClosureAlert：可以结束连接，防止截断攻击。

- SSL更改密码规格协议：
Change Cipher Spec Protocol具有以下特性：
① 位于SSL记录协议之上。
② ContentType=20。
③ 协议只包含一条消息（一个值为1的字节）。
> 把未决状态设置为当前状态，更新当前连接的密钥组，这标志着加密策略的改变。

- SSL警告协议：

  Alert消息：当握手过程或数据加密等出错或发生异常时，为对等实体传递SSL警告或终止当前连接。

  Alert Protocol具有以下特性：
  ① 位于SSL记录协议之上。
  ② ContentType=21。
  ③ 协议包含两个字节：警告级别和警告代码。

- HTTP

  

第二层：

- SSL记录协议：用会话密钥来加/解密数据（后）

  Record Protocol描述SSL信息交换过程中的记录格式。所有数据（含SSL握手信息）都被封装在记录中，一个记录由两部分组成：记录头和数据。

  SSL记录协议的操作步骤：
          将数据分段成可操作的数据块
           对分块数据进行数据压缩
           计算MAC值
           对压缩数据及MAC值加密
           加入SSL记录头
           在TCP中传输结果单元

  SSL记录协议的操作步骤：

  ![1561535273242](C:\Users\xiaoxx\AppData\Roaming\Typora\typora-user-images\1561535273242.png)

- SSL实现的安全服务
      • 机密性：SSL 客户机和服务器之间传送加密数据。
      • 完整性：SSL 可避免服务器和客户机之间的信息被破坏。
      • 认证性：SSL 握手时要求交换证书，通过验证证书来保证对方身份的合法性。 
